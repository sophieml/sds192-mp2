---
title: "Mini-Project 2"
author: "Your Name Here"
date: "October 31, 2017"
output: html_document
---
A new edit
Edit number 2

## Loading the data

```{r, include=FALSE}
library(tidyverse)

load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
load("individuals.rda")
state_household_income <- read.csv("state_household_income.csv")

```

```{r}
contributions %>% 
  group_by(state) %>% 
  summarize(s = sum(transaction_amt))%>%
  arrange(desc(s))
```

```{r}
most_common_occupations <- individuals %>% 
  filter(!is.na(occupation)) %>%
  group_by(occupation) %>% 
  summarize(num_occ = n()) %>% 
  filter(num_occ > 10000) %>% 
  mutate(occ_type = occupation) %>%
  mutate(occ_type = case_when(
    occ_type == 'RETIRED' ~ 'not working',
    occ_type == 'ATTORNEY' ~ 'law',
    occ_type == 'HOMEMAKER' ~ 'not working',
    occ_type == 'PHYSICIAN' ~ 'healthcare',
    occ_type == 'PRESIDENT' ~ 'executive',
    occ_type == 'EXECUTIVE' ~ 'executive',
    occ_type ==  'CONSULTANT' ~ 'business',
    occ_type ==  'OWNER' ~ 'self employed',
    occ_type ==  'CEO' ~ 'executive',
    occ_type ==  'PROFESSOR' ~ 'education',
    occ_type ==  'PARTNER' ~ 'other',
    occ_type ==  'LAWYER' ~ 'law',
    occ_type == 'ENGINEER' ~ 'scientist/engineer',
    occ_type ==  'MANAGER' ~ 'business',
    occ_type ==  'NOT EMPLOYED' ~ 'not working',
    occ_type ==  'FARMER' ~ 'agriculture',
    occ_type == 'VICE PRESIDENT' ~ 'executive',
    occ_type == 'REAL ESTATE' ~ 'real estate',
    occ_type == 'INVESTOR' ~ 'finance',
    occ_type ==   'NONE' ~ 'not working',
    occ_type ==  'SALES' ~ 'business',
    occ_type == 'BUSINESS OWNER' ~ 'self employed',
    occ_type == 'TEACHER' ~ 'education',
    occ_type ==   'DIRECTOR' ~ 'executive',
    occ_type ==  'SELF-EMPLOYED' ~ 'self employed',
    occ_type ==  'CHAIRMAN' ~ 'executive',
    occ_type ==  'WRITER' ~ 'other',
    occ_type ==  'CPA' ~ 'finance',
    occ_type ==  'BANKER' ~ 'finance',
    occ_type ==  'DENTIST' ~ 'healthcare',
    occ_type ==  'PRINCIPAL' ~ 'education',
    occ_type ==  'REAL ESTATE BROKER' ~ 'real estate',
    occ_type ==  'REALTOR' ~ 'real estate',
    occ_type == TRUE ~ occ_type
  )) %>% 
  filter(!is.na(occ_type)) %>% 
  arrange(desc(num_occ))

ggplot(most_common_occupations, aes(x = occupation, y = num_occ, color = occ_type)) +
  geom_point() +
  facet_wrap( ~ occ_type)
```

```{r}
state_contributions <- individuals %>% 
  filter( individuals$state %in%candidates$cand_office_state) %>%
  group_by(state) %>% 
  summarize(med_amt = mean(abs(transaction_amt), na.rm = TRUE), max_amt = max(transaction_amt)) %>% 
  arrange(desc(med_amt))
```

```{r}
state_data <- left_join(state_contributions, state_household_income)
ggplot(state_data, aes(x = household_income, y = med_amt)) + 
  geom_text(aes(label = state, size = max_amt), alpha = 0.5)
```
